<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>attack-workbench-frontend documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">attack-workbench-frontend documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li>Interfaces</li>
  <li
  >
  HistoryEvent</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/components/resources-drawer/history-timeline/history-timeline.component.ts</code>
        </p>




        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#change_types" 
>
                                            change_types
                                        </a>
                                </li>
                                <li>
                                        <a href="#description" 
>
                                            description
                                        </a>
                                </li>
                                <li>
                                        <a href="#icon" 
>
                                            icon
                                        </a>
                                </li>
                                <li>
                                        <a href="#name" 
>
                                            name
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#prior_state" 
>
                                            prior_state
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#prior_version" 
>
                                            prior_version
                                        </a>
                                </li>
                                <li>
                                        <a href="#sdo" 
>
                                            sdo
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="change_types"></a>
                                        <span class="name "><b>change_types</b>
                                            <a href="#change_types">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>change_types:     <code>literal type</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>literal type</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="description"></a>
                                        <span class="name "><b>description</b>
                                            <a href="#description">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>description:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="icon"></a>
                                        <span class="name "><b>icon</b>
                                            <a href="#icon">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>icon:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="name"></a>
                                        <span class="name "><b>name</b>
                                            <a href="#name">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="prior_state"></a>
                                        <span class="name "><b>prior_state</b>
                                            <a href="#prior_state">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>prior_state:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="prior_version"></a>
                                        <span class="name "><b>prior_version</b>
                                            <a href="#prior_version">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>prior_version:         <code><a href="../classes/VersionNumber.html" target="_self" >VersionNumber</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="../classes/VersionNumber.html" target="_self" >VersionNumber</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="sdo"></a>
                                        <span class="name "><b>sdo</b>
                                            <a href="#sdo">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>sdo:         <code><a href="../classes/StixObject.html" target="_self" >StixObject</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="../classes/StixObject.html" target="_self" >StixObject</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, EventEmitter, OnDestroy, OnInit, Output, ViewEncapsulation } from &#x27;@angular/core&#x27;;
import { MatDialog } from &#x27;@angular/material/dialog&#x27;;
import { ActivatedRoute, Router } from &#x27;@angular/router&#x27;;
import { forkJoin, Subscription } from &#x27;rxjs&#x27;;
import { Collection } from &#x27;src/app/classes/stix/collection&#x27;;
import { Relationship } from &#x27;src/app/classes/stix/relationship&#x27;;
import { StixObject } from &#x27;src/app/classes/stix/stix-object&#x27;;
import { VersionNumber } from &#x27;src/app/classes/version-number&#x27;;
import { RestApiConnectorService } from &#x27;src/app/services/connectors/rest-api/rest-api-connector.service&#x27;;
import { EditorService } from &#x27;src/app/services/editor/editor.service&#x27;;
import { StixDialogComponent } from &#x27;src/app/views/stix/stix-dialog/stix-dialog.component&#x27;;

interface HistoryEvent {
    change_types: {
        versionChanged: boolean; // did the version number change? corresponds to prior_version
        stateChanged: boolean; // did the workflow state change?
        objectCreated: boolean; // was the object created?
        objectImported: boolean; // was the object imported for the first time,
        release: boolean; //for collections, was this a release?
    }
    icon: string; // icon representing the change
    name: string; //name of the object being changed
    description: string; // description of what happened in the event
    sdo: StixObject; // StixObject version corresponding to the event (post-change)
    prior_version?: VersionNumber; // if specified, the version number changed; this field is the prior version number
    prior_state?: string; // if specified, the workflow state changed; this field is the prior workflow state
}

@Component({
  selector: &#x27;app-history-timeline&#x27;,
  templateUrl: &#x27;./history-timeline.component.html&#x27;,
  styleUrls: [&#x27;./history-timeline.component.scss&#x27;],
  encapsulation: ViewEncapsulation.None
})
export class HistoryTimelineComponent implements OnInit, OnDestroy {

    public historyEvents: HistoryEvent[];
    public loading: boolean &#x3D; false;
    public hoveredHistoryEvent: HistoryEvent &#x3D; null;
    public showObjectHistory: boolean &#x3D; true;
    public showRelationshipHistory: boolean &#x3D; true;
    public onEditStopSubscription: Subscription;
    
    

    constructor(private route: ActivatedRoute, 
                private router: Router, 
                private restAPIConnectorService: RestApiConnectorService,
                private dialog: MatDialog,
                private editorService: EditorService) {
                    
        this.onEditStopSubscription &#x3D; this.editorService.onEditingStopped.subscribe({
            next: () &#x3D;&gt; { this.loadHistory(); }
        })
    }

    /**
     * transform the object versions into HistoryEvent objects and add them to the HistoryEvents array
     */
    private parseHistory(objectVersions: StixObject[], relationships: Relationship[]): void {
        // ensure that the stix objects are sorted in ascending order of date
        objectVersions &#x3D; objectVersions.sort((a,b) &#x3D;&gt; (a.modified as any) - (b.modified as any)); 
        relationships &#x3D; relationships.sort((a,b) &#x3D;&gt; (a.modified as any) - (b.modified as any)); 
        // clear previously parsed historyEvents
        this.historyEvents &#x3D; [];
        // build historyEvents for the object itself
        let previousVersion &#x3D; null;
        let previousState &#x3D; null;
        for (let objectVersion of objectVersions) {
            let versionChanged &#x3D; previousVersion &amp;&amp; objectVersion.version.compareTo(previousVersion) !&#x3D; 0;
            let stateChanged &#x3D; previousState &amp;&amp; objectVersion.workflow &amp;&amp; objectVersion.workflow.state ? objectVersion.workflow.state !&#x3D; previousState : false;
            let objectCreated &#x3D; objectVersion.created.getTime() &#x3D;&#x3D; objectVersion.modified.getTime();
            let release &#x3D; objectVersion.attackType &#x3D;&#x3D; &quot;collection&quot; &amp;&amp; (objectVersion as Collection).release;
            let objectImported &#x3D; !objectCreated &amp;&amp; !previousVersion;
            let description &#x3D; objectCreated? &#x60;${objectVersion[&quot;name&quot;]} was created&#x60; : objectImported? &#x60;Earliest imported version of ${objectVersion[&quot;name&quot;]}&#x60; : &#x60;${objectVersion[&quot;name&quot;]} was edited&#x60;
            this.historyEvents.push({
                change_types: {
                    versionChanged: versionChanged,
                    stateChanged: stateChanged,
                    objectImported: objectImported,
                    objectCreated: objectCreated,
                    release: release
                },
                icon: objectImported? &quot;cloud_download&quot; : objectCreated? &quot;add&quot; : &quot;edit&quot;,
                name: objectVersion[&quot;name&quot;],
                description: description,
                sdo: objectVersion,
                prior_version: versionChanged? previousVersion : null,
                prior_state: stateChanged ? previousState : &#x27;unset&#x27;
            })
            previousVersion &#x3D; objectVersion.version;
            previousState &#x3D; objectVersion.workflow ? objectVersion.workflow.state : &#x27;unset&#x27;;
        }

        // group relationships by ID
        let stixIDtoRelVersions &#x3D; {};
        for (let relationship of relationships) {
            if (relationship.stixID in stixIDtoRelVersions) stixIDtoRelVersions[relationship.stixID].push(relationship);
            else stixIDtoRelVersions[relationship.stixID] &#x3D; [relationship];
        }

        // build historyEvents for relationships
        for (let relationshipID in stixIDtoRelVersions) {
            let firstVersion &#x3D; true;
            for (let relationshipVersion of stixIDtoRelVersions[relationshipID]) {
                let objectCreated &#x3D; relationshipVersion.created.getTime() &#x3D;&#x3D; relationshipVersion.modified.getTime();
                let objectImported &#x3D; !objectCreated &amp;&amp; firstVersion;
                let relationshipName &#x3D; &#x60;${relationshipVersion.source_name} ${relationshipVersion.relationship_type} ${relationshipVersion.target_name}&#x60;
                let description &#x3D; objectCreated? &#x60;${relationshipName} was created&#x60; : objectImported? &#x60;Earliest imported version of ${relationshipName}&#x60; : &#x60;${relationshipName} was edited&#x60;

                this.historyEvents.push({
                    change_types: {
                        versionChanged: false,
                        stateChanged: false,
                        objectImported: objectImported,
                        objectCreated: objectCreated,
                        release: false
                    },
                    icon: objectImported? &quot;cloud_download&quot; : objectCreated? &quot;add&quot; : &quot;edit&quot;,
                    name: relationshipName,
                    description: description,
                    sdo: relationshipVersion,
                })
                firstVersion &#x3D; false;
            }
        }
        
        this.historyEvents.sort((a,b) &#x3D;&gt; (b.sdo.modified as any) - (a.sdo.modified as any));
    }

    public preview(sdo: StixObject) {
        this.dialog.open(StixDialogComponent, {
            data: {
                object: sdo,
                editable: false,
                sidebarControl: &quot;disable&quot;
            },
            maxHeight: &quot;75vh&quot;
        });
    }

    public loadHistory() {
        this.loading &#x3D; true;
        let objectType &#x3D; this.router.url.split(&quot;/&quot;)[1];
        let objectStixID &#x3D; this.router.url.split(&quot;/&quot;)[2].split(&quot;?&quot;)[0];
        // set up subscribers to get object versions
        let objects$;
        if (objectType &#x3D;&#x3D; &quot;software&quot;) objects$ &#x3D; this.restAPIConnectorService.getSoftware(objectStixID, null, &quot;all&quot;);
        else if (objectType &#x3D;&#x3D; &quot;group&quot;) objects$ &#x3D; this.restAPIConnectorService.getGroup(objectStixID, null, &quot;all&quot;);
        else if (objectType &#x3D;&#x3D; &quot;matrix&quot;) objects$ &#x3D; this.restAPIConnectorService.getMatrix(objectStixID, null, &quot;all&quot;);
        else if (objectType &#x3D;&#x3D; &quot;mitigation&quot;) objects$ &#x3D; this.restAPIConnectorService.getMitigation(objectStixID, null, &quot;all&quot;);
        else if (objectType &#x3D;&#x3D; &quot;tactic&quot;) objects$ &#x3D; this.restAPIConnectorService.getTactic(objectStixID, null, &quot;all&quot;);
        else if (objectType &#x3D;&#x3D; &quot;campaign&quot;) objects$ &#x3D; this.restAPIConnectorService.getCampaign(objectStixID, null, &quot;all&quot;);
        else if (objectType &#x3D;&#x3D; &quot;technique&quot;) objects$ &#x3D; this.restAPIConnectorService.getTechnique(objectStixID, null, &quot;all&quot;);
        else if (objectType &#x3D;&#x3D; &quot;collection&quot;) objects$ &#x3D; this.restAPIConnectorService.getCollection(objectStixID, null, &quot;all&quot;);
        else if (objectType &#x3D;&#x3D; &quot;data-source&quot;) objects$ &#x3D; this.restAPIConnectorService.getDataSource(objectStixID, null, &quot;all&quot;);
        else if (objectType &#x3D;&#x3D; &quot;data-component&quot;) objects$ &#x3D; this.restAPIConnectorService.getDataComponent(objectStixID, null, &quot;all&quot;);
        // set up subscribers to get relationships
        let relationships$ &#x3D; this.restAPIConnectorService.getRelatedTo({sourceOrTargetRef: objectStixID, versions: &quot;all&quot;});
        // join subscribers
        let subscription &#x3D; forkJoin({
            objectVersions: objects$,
            relationships: relationships$,
        }).subscribe({
            next: (result) &#x3D;&gt; {
                this.parseHistory(result.objectVersions as StixObject[], result.relationships.data as Relationship[]);
                this.loading &#x3D; false;
            },
            complete: () &#x3D;&gt; { subscription.unsubscribe() }
        });
    }

    ngOnInit(): void {
        this.loadHistory();
    }

    ngOnDestroy(): void {
        this.onEditStopSubscription.unsubscribe();
    }

}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'HistoryEvent.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
